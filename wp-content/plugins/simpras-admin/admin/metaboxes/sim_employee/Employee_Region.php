<?php/** * Created by PhpStorm. * User: Vadim * Date: 2015-04-27 * Time: 08:47 */class Employee_Region{    public $id;    public $title;    public $context;    public $priority;    public $post_types;    public function __construct()    {        $this->id = 'ssim_employee_region';        $this->title = __('Select region', 'sim');        $this->context = 'normal';        $this->priority = 'default';        $this->post_types = array('sim_employee');        add_action('admin_enqueue_scripts', array($this, 'styles_and_scripts'));        add_filter('wp_ajax_nopriv_map_regions_list', array($this, 'sim_map_regions_list'), 0, 0);        add_filter('wp_ajax_map_regions_list', array($this, 'sim_map_regions_list'), 0, 0);        add_action('save_post', array($this, 'meta_box_save'), 10, 1);    }    /**     * Add admin styles     */    public function styles_and_scripts()    {        global $post, $wp_scripts;        if (isset($post) && $post && !in_array(                $post->post_type,                $this->post_types            )        )        {            return;        }else if (isset($post) && $post){            wp_register_script('svg-map-controller', SIM_RESOURCES_URL.'js/svg-map-controller.js', array('jquery'));            wp_enqueue_script('svg-map-controller');            $dataArr = array(                'post_id' => $post->ID,            );            wp_localize_script( 'svg-map-controller', 'admin_post', $dataArr );        }    }    public function sim_map_regions_list()    {        $post_id = isset($_POST['post_id']) ? $_POST['post_id'] : false;        if (!$post_id) {            return null;        }        $employee = SIM_Employee::getById($post_id);        $regions = $employee->getRegionsArray();        echo json_encode($regions);        die();    }    public function meta_box_inner($post)    {        $post_id = $post->ID;        ?>        <style>            svg {                width: 100%;            }        </style>        <div class="row">            <?php echo file_get_contents(get_template_directory_uri().'/img/map.svg'); ?>            <input type="hidden" id="employee_regions" name="employee_regions">        </div>        <?php    }    function meta_box_save($post_id)    {        if (in_array(get_post_type($post_id), $this->post_types)) {            $employee = SIM_Employee::getById($post_id);            if (isset($_POST['employee_regions']) && !empty($_POST['employee_regions'])) {                $regions = json_decode(stripslashes($_POST['employee_regions']), true);                $employee->employee_region = serialize($regions);                $employee->save();            } else {            }        }    }}return new Employee_Region();